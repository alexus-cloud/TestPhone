<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Debugger</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 800px; margin: 2rem auto; padding: 0 1rem; }
        .input-group { margin-bottom: 1rem; display: flex; gap: 0.5rem; }
        input { padding: 0.5rem; flex-grow: 1; font-family: monospace; }
        button { padding: 0.5rem 1rem; cursor: pointer; }
        #logs { background: #f5f5f5; padding: 1rem; border-radius: 4px; border: 1px solid #ddd; height: 400px; overflow-y: auto; font-family: monospace; white-space: pre-wrap; }
        .error { color: #d32f2f; }
        .success { color: #2e7d32; }
        .info { color: #0288d1; }
    </style>
</head>
<body>
    <h1>WebSocket Debugger</h1>
    
    <div class="input-group">
        <label for="url">URL:</label>
        <input type="text" id="url" value="wss://100140.ringotel.co" placeholder="wss://example.com">
    </div>
    <div class="input-group">
        <label for="protocols">Protocols:</label>
        <input type="text" id="protocols" value="sip" placeholder="Protocols (e.g. sip)">
    </div>
    <div class="input-group">
        <button id="btnConnect">Connect</button>
        <button id="btnDisconnect" disabled>Disconnect</button>
    </div>

    <h3>Logs:</h3>
    <div id="logs"></div>

    <script>
        let ws;
        const logs = document.getElementById('logs');
        const btnConnect = document.getElementById('btnConnect');
        const btnDisconnect = document.getElementById('btnDisconnect');
        const urlInput = document.getElementById('url');
        const protocolsInput = document.getElementById('protocols');

        function log(msg, type = 'info') {
            const line = document.createElement('div');
            line.className = type;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logs.appendChild(line);
            logs.scrollTop = logs.scrollHeight;
            console.log(msg);
        }

        function connect() {
            const url = urlInput.value;
            const protocols = protocolsInput.value.split(',').map(p => p.trim()).filter(p => p);

            if (!url) {
                log('Please enter a URL', 'error');
                return;
            }

            try {
                log(`Attempting connection to ${url}...`, 'info');
                if (protocols.length) {
                    log(`Using protocols: ${JSON.stringify(protocols)}`, 'info');
                    ws = new WebSocket(url, protocols); 
                } else {
                    ws = new WebSocket(url);
                }

                btnConnect.disabled = true;
                btnDisconnect.disabled = false;

                ws.onopen = () => {
                   log('Connection ESTABLISHED', 'success');
                   if (ws.protocol) {
                       log(`Protocol selected: ${ws.protocol}`, 'success');
                   } else {
                       log('No subprotocol selected by server.', 'info');
                   }
                   log('ReadyState: ' + ws.readyState, 'success');
                };

                ws.onmessage = (event) => {
                    log('Received message: ' + event.data, 'info');
                };

                ws.onclose = (event) => {
                    let msg = `Connection CLOSED. Code: ${event.code}`;
                    if (event.reason) msg += `, Reason: ${event.reason}`;
                    
                    log(msg, event.code === 1000 ? 'success' : 'error');
                    
                    if (event.code === 1006) {
                        log('Error 1006 Hints:', 'error');
                        log('  1. SSL Certificate failure (Self-signed/Untrusted/Hostname mismatch)', 'error');
                        log('  2. Server is down or unreachable', 'error');
                        log('  3. Server rejected protocol (try clearing "sip")', 'error');
                    }
                    cleanup();
                };

                ws.onerror = (error) => {
                    log('WebSocket Error event fired.', 'error');
                };

            } catch (err) {
                log(`Exception: ${err.message}`, 'error');
                cleanup();
            }
        }

        function disconnect() {
            if (ws) {
                log('Disconnecting...', 'info');
                ws.close();
            }
        }

        function cleanup() {
            ws = null;
            btnConnect.disabled = false;
            btnDisconnect.disabled = true;
        }

        btnConnect.addEventListener('click', connect);
        btnDisconnect.addEventListener('click', disconnect);
    </script>
</body>
</html>
